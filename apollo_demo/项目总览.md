# Apolloé…ç½®ä¸­å¿ƒPythonå®¢æˆ·ç«¯Demo - é¡¹ç›®æ€»è§ˆ

## ğŸ“ é¡¹ç›®ç»“æ„

```
apollo_demo/
â”œâ”€â”€ requirements.txt          # Pythonä¾èµ–åŒ…
â”œâ”€â”€ config.py                # é…ç½®ç®¡ç†ç±»
â”œâ”€â”€ apollo_client.py         # Apolloå®¢æˆ·ç«¯æ ¸å¿ƒå®ç°
â”œâ”€â”€ demo.py                  # å®Œæ•´åŠŸèƒ½æ¼”ç¤º
â”œâ”€â”€ simple_demo.py           # ç®€åŒ–ç¤ºä¾‹
â”œâ”€â”€ test_apollo.py           # å•å…ƒæµ‹è¯•
â”œâ”€â”€ run_demo.sh              # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ .env.example             # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ README.md                # è‹±æ–‡è¯´æ˜æ–‡æ¡£
â””â”€â”€ é¡¹ç›®æ€»è§ˆ.md              # ä¸­æ–‡é¡¹ç›®æ€»è§ˆ
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd apollo_demo

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate     # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. é…ç½®è®¾ç½®

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶
vim .env
```

ä¿®æ”¹ `.env` æ–‡ä»¶ä¸­çš„å…³é”®é…ç½®ï¼š
```bash
# ApolloæœåŠ¡å™¨åœ°å€
APOLLO_SERVER_URL=http://your-apollo-server:8080

# åº”ç”¨ID
APOLLO_APP_ID=your-app-id

# å‘½åç©ºé—´
APOLLO_NAMESPACE=application
```

### 3. è¿è¡ŒDemo

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
```bash
./run_demo.sh
```

#### æ–¹å¼äºŒï¼šç›´æ¥è¿è¡Œ
```bash
# å®Œæ•´äº¤äº’å¼Demo
python demo.py

# ç®€å•ç¤ºä¾‹
python simple_demo.py

# å¿«é€Ÿå¼€å§‹
python simple_demo.py quick
```

## ğŸ“‹ æ ¸å¿ƒåŠŸèƒ½

### 1. é…ç½®è·å–
- âœ… è·å–å•ä¸ªé…ç½®é¡¹
- âœ… è·å–æ‰€æœ‰é…ç½®
- âœ… æ”¯æŒé»˜è®¤å€¼
- âœ… å¼‚å¸¸å¤„ç†

### 2. é…ç½®ç›‘å¬
- âœ… é•¿è½®è¯¢ç›‘å¬é…ç½®å˜æ›´
- âœ… è‡ªå®šä¹‰ç›‘å¬å™¨å›è°ƒ
- âœ… å®æ—¶é…ç½®æ›´æ–°

### 3. ç¼“å­˜æœºåˆ¶
- âœ… æœ¬åœ°é…ç½®ç¼“å­˜
- âœ… ç¼“å­˜æ–‡ä»¶æŒä¹…åŒ–
- âœ… ç¼“å­˜è‡ªåŠ¨æ›´æ–°

### 4. ä¸Šä¸‹æ–‡ç®¡ç†
- âœ… è‡ªåŠ¨èµ„æºæ¸…ç†
- âœ… å¼‚å¸¸å®‰å…¨å¤„ç†

## ğŸ”§ æ ¸å¿ƒç±»è¯´æ˜

### ApolloConfig ç±»
è´Ÿè´£ç®¡ç†Apolloè¿æ¥é…ç½®ï¼Œæ”¯æŒç¯å¢ƒå˜é‡é…ç½®ã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**
- è¯»å–ç¯å¢ƒå˜é‡é…ç½®
- æä¾›é»˜è®¤é…ç½®å€¼
- é…ç½®éªŒè¯å’Œæ ¼å¼åŒ–

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```python
from config import ApolloConfig

config = ApolloConfig()
config.print_config()  # æ‰“å°å½“å‰é…ç½®
```

### ApolloClient ç±»
Apolloå®¢æˆ·ç«¯çš„æ ¸å¿ƒå®ç°ï¼Œæä¾›å®Œæ•´çš„é…ç½®ç®¡ç†åŠŸèƒ½ã€‚

**ä¸»è¦åŠŸèƒ½ï¼š**
- è¿æ¥ApolloæœåŠ¡å™¨
- è·å–å’Œç¼“å­˜é…ç½®
- ç›‘å¬é…ç½®å˜æ›´
- ç®¡ç†ç›‘å¬å™¨

**ä½¿ç”¨ç¤ºä¾‹ï¼š**
```python
from apollo_client import ApolloClient
from config import ApolloConfig

config = ApolloConfig()
client = ApolloClient(config)

# è·å–é…ç½®
value = client.get_config('database.url', 'localhost:3306')

# æ·»åŠ ç›‘å¬å™¨
def on_change(key, old_value, new_value):
    print(f"é…ç½®å˜æ›´: {key} = {old_value} -> {new_value}")

client.add_listener('database.url', on_change)
client.start_long_polling()
```

## ğŸ“– ä½¿ç”¨åœºæ™¯

### 1. åŸºç¡€é…ç½®è·å–
```python
# è·å–æ•°æ®åº“é…ç½®
db_url = client.get_config('database.url', 'localhost:3306')
db_user = client.get_config('database.username', 'root')
db_pass = client.get_config('database.password', '')

# è·å–Redisé…ç½®
redis_host = client.get_config('redis.host', 'localhost')
redis_port = int(client.get_config('redis.port', '6379'))
```

### 2. é…ç½®å˜æ›´ç›‘å¬
```python
def database_config_handler(key, old_value, new_value):
    if key == 'database.url':
        # é‡æ–°è¿æ¥æ•°æ®åº“
        reconnect_database(new_value)
    elif key == 'database.pool_size':
        # è°ƒæ•´è¿æ¥æ± å¤§å°
        adjust_connection_pool(int(new_value))

client.add_listener('database.url', database_config_handler)
client.add_listener('database.pool_size', database_config_handler)
client.start_long_polling()
```

### 3. åº”ç”¨é…ç½®ç®¡ç†
```python
# è·å–åº”ç”¨é…ç½®
app_name = client.get_config('app.name', 'my-app')
debug_mode = client.get_config('app.debug', 'false').lower() == 'true'
log_level = client.get_config('app.log_level', 'INFO')

# è·å–æ‰€æœ‰é…ç½®
all_configs = client.get_all_configs()
print(f"åº”ç”¨ {app_name} çš„é…ç½®: {all_configs}")
```

## ğŸ§ª æµ‹è¯•

è¿è¡Œå•å…ƒæµ‹è¯•ï¼š
```bash
python test_apollo.py
```

æµ‹è¯•è¦†ç›–çš„åŠŸèƒ½ï¼š
- âœ… é…ç½®ç±»æµ‹è¯•
- âœ… å®¢æˆ·ç«¯åŸºæœ¬åŠŸèƒ½æµ‹è¯•
- âœ… ç›‘å¬å™¨ç®¡ç†æµ‹è¯•
- âœ… ç¼“å­˜æ“ä½œæµ‹è¯•
- âœ… ä¸Šä¸‹æ–‡ç®¡ç†å™¨æµ‹è¯•

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **è¿æ¥å¤±è´¥**
   - æ£€æŸ¥ApolloæœåŠ¡å™¨åœ°å€æ˜¯å¦æ­£ç¡®
   - ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
   - éªŒè¯é˜²ç«å¢™è®¾ç½®

2. **é…ç½®è·å–å¤±è´¥**
   - æ£€æŸ¥AppIdæ˜¯å¦æ­£ç¡®
   - ç¡®è®¤å‘½åç©ºé—´å­˜åœ¨
   - éªŒè¯é…ç½®é¡¹å·²åˆ›å»º

3. **ç›‘å¬å™¨ä¸å·¥ä½œ**
   - ç¡®è®¤é•¿è½®è¯¢å·²å¯åŠ¨
   - æ£€æŸ¥ç›‘å¬å™¨æ³¨å†Œæ­£ç¡®
   - éªŒè¯ApolloæœåŠ¡å™¨æ”¯æŒé•¿è½®è¯¢

### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

2. **æ£€æŸ¥ç¼“å­˜æ–‡ä»¶**
```bash
ls -la apollo_cache/
cat apollo_cache/demo-app_application.json
```

3. **æµ‹è¯•ç½‘ç»œè¿æ¥**
```bash
curl http://your-apollo-server:8080/configs/demo-app/default/application
```

## ğŸ“š æ‰©å±•å¼€å‘

### 1. æ·»åŠ æ–°åŠŸèƒ½
- é…ç½®åŠ å¯†/è§£å¯†
- é…ç½®éªŒè¯è§„åˆ™
- å¤šç¯å¢ƒæ”¯æŒ
- é…ç½®çƒ­é‡è½½

### 2. é›†æˆåˆ°ç°æœ‰é¡¹ç›®
```python
# åœ¨Flaskåº”ç”¨ä¸­ä½¿ç”¨
from flask import Flask
from apollo_client import ApolloClient
from config import ApolloConfig

app = Flask(__name__)

# åˆå§‹åŒ–Apolloå®¢æˆ·ç«¯
config = ApolloConfig()
apollo_client = ApolloClient(config)

@app.route('/config/<key>')
def get_config(key):
    return {'value': apollo_client.get_config(key, '')}
```

### 3. è‡ªå®šä¹‰é…ç½®ç±»å‹
```python
import json

# JSONé…ç½®æ”¯æŒ
def get_json_config(client, key, default='{}'):
    value = client.get_config(key, default)
    return json.loads(value)

# æ•°å­—é…ç½®æ”¯æŒ
def get_int_config(client, key, default=0):
    value = client.get_config(key, str(default))
    return int(value)
```

## ğŸ“„ è®¸å¯è¯

MIT License - å¯è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹å’Œåˆ†å‘ã€‚

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestæ¥æ”¹è¿›è¿™ä¸ªé¡¹ç›®ï¼

---

**æ³¨æ„ï¼š** è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºé¡¹ç›®ï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ—¶è¯·æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œè°ƒæ•´å’Œä¼˜åŒ–ã€‚