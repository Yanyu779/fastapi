# Apolloé…ç½®ä¸­å¿ƒPythonå®¢æˆ·ç«¯Demo - ä½¿ç”¨æŒ‡å—

## ğŸ¯ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªå®Œæ•´çš„Apolloé…ç½®ä¸­å¿ƒPythonå®¢æˆ·ç«¯ç¤ºä¾‹ï¼Œæä¾›äº†è¿æ¥Apolloé…ç½®ä¸­å¿ƒã€è·å–é…ç½®ã€ç›‘å¬é…ç½®å˜æ›´ç­‰å®Œæ•´åŠŸèƒ½ã€‚

## ğŸ“¦ é¡¹ç›®æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `requirements.txt` | Pythonä¾èµ–åŒ…åˆ—è¡¨ |
| `config.py` | é…ç½®ç®¡ç†ç±» |
| `apollo_client.py` | Apolloå®¢æˆ·ç«¯æ ¸å¿ƒå®ç° |
| `demo.py` | å®Œæ•´åŠŸèƒ½æ¼”ç¤º |
| `simple_demo.py` | ç®€åŒ–ç¤ºä¾‹ |
| `test_apollo.py` | å•å…ƒæµ‹è¯• |
| `test_basic.py` | åŸºç¡€æµ‹è¯•ï¼ˆæ— éœ€ä¾èµ–ï¼‰ |
| `run_demo.sh` | å¯åŠ¨è„šæœ¬ |
| `.env.example` | ç¯å¢ƒå˜é‡æ¨¡æ¿ |
| `README.md` | è‹±æ–‡è¯´æ˜æ–‡æ¡£ |
| `é¡¹ç›®æ€»è§ˆ.md` | ä¸­æ–‡é¡¹ç›®æ€»è§ˆ |
| `ä½¿ç”¨æŒ‡å—.md` | æœ¬æ–‡ä»¶ |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd apollo_demo

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate     # Windows

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. é…ç½®è®¾ç½®

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼ˆæ ¹æ®éœ€è¦ä¿®æ”¹ï¼‰
vim .env
```

### 3. è¿è¡ŒDemo

#### æ–¹å¼ä¸€ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
```bash
./run_demo.sh
```

#### æ–¹å¼äºŒï¼šç›´æ¥è¿è¡Œ
```bash
# å®Œæ•´äº¤äº’å¼Demo
python demo.py

# ç®€å•ç¤ºä¾‹
python simple_demo.py

# å¿«é€Ÿå¼€å§‹
python simple_demo.py quick
```

## ğŸ“‹ æ ¸å¿ƒåŠŸèƒ½æ¼”ç¤º

### 1. åŸºç¡€é…ç½®è·å–

```python
from config import ApolloConfig
from apollo_client import ApolloClient

# åˆ›å»ºé…ç½®å’Œå®¢æˆ·ç«¯
config = ApolloConfig()
client = ApolloClient(config)

# è·å–å•ä¸ªé…ç½®
db_url = client.get_config('database.url', 'localhost:3306')
print(f"æ•°æ®åº“URL: {db_url}")

# è·å–æ‰€æœ‰é…ç½®
all_configs = client.get_all_configs()
print(f"æ‰€æœ‰é…ç½®: {all_configs}")
```

### 2. é…ç½®å˜æ›´ç›‘å¬

```python
def on_config_change(key, old_value, new_value):
    print(f"é…ç½®å˜æ›´: {key} = {old_value} -> {new_value}")

# æ·»åŠ ç›‘å¬å™¨
client.add_listener('database.url', on_config_change)
client.add_listener('redis.host', on_config_change)

# å¼€å§‹ç›‘å¬
client.start_long_polling()

# åœæ­¢ç›‘å¬
client.stop_long_polling()
```

### 3. ä¸Šä¸‹æ–‡ç®¡ç†å™¨

```python
with ApolloClient(config) as client:
    # åœ¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨ä¸­ä½¿ç”¨å®¢æˆ·ç«¯
    value = client.get_config('test.key', 'default_value')
    print(f"é…ç½®å€¼: {value}")
    # é€€å‡ºæ—¶è‡ªåŠ¨æ¸…ç†èµ„æº
```

## ğŸ”§ é…ç½®å‚æ•°

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `APOLLO_SERVER_URL` | ApolloæœåŠ¡å™¨åœ°å€ | `http://localhost:8080` |
| `APOLLO_APP_ID` | åº”ç”¨ID | `demo-app` |
| `APOLLO_CLUSTER` | é›†ç¾¤åç§° | `default` |
| `APOLLO_NAMESPACE` | å‘½åç©ºé—´ | `application` |
| `APOLLO_ENABLE_LONG_POLLING` | æ˜¯å¦å¯ç”¨é•¿è½®è¯¢ | `true` |
| `APOLLO_POLLING_INTERVAL` | è½®è¯¢é—´éš”ï¼ˆç§’ï¼‰ | `30` |
| `APOLLO_TIMEOUT` | è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰ | `30` |
| `APOLLO_ENABLE_CACHE` | æ˜¯å¦å¯ç”¨ç¼“å­˜ | `true` |
| `APOLLO_CACHE_DIR` | ç¼“å­˜ç›®å½• | `./apollo_cache` |

## ğŸ§ª æµ‹è¯•

### åŸºç¡€æµ‹è¯•ï¼ˆæ— éœ€ä¾èµ–ï¼‰
```bash
python3 test_basic.py
```

### å®Œæ•´æµ‹è¯•ï¼ˆéœ€è¦å®‰è£…ä¾èµ–ï¼‰
```bash
# å…ˆå®‰è£…ä¾èµ–
pip install -r requirements.txt

# è¿è¡Œæµ‹è¯•
python test_apollo.py
```

## ğŸ“š ä½¿ç”¨åœºæ™¯

### 1. åº”ç”¨é…ç½®ç®¡ç†
```python
# è·å–åº”ç”¨é…ç½®
app_name = client.get_config('app.name', 'my-app')
debug_mode = client.get_config('app.debug', 'false').lower() == 'true'
log_level = client.get_config('app.log_level', 'INFO')
```

### 2. æ•°æ®åº“é…ç½®
```python
# è·å–æ•°æ®åº“é…ç½®
db_url = client.get_config('database.url', 'localhost:3306')
db_user = client.get_config('database.username', 'root')
db_pass = client.get_config('database.password', '')
max_connections = int(client.get_config('database.max_connections', '10'))
```

### 3. ç¼“å­˜é…ç½®
```python
# è·å–Redisé…ç½®
redis_host = client.get_config('redis.host', 'localhost')
redis_port = int(client.get_config('redis.port', '6379'))
redis_db = int(client.get_config('redis.db', '0'))
```

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **è¿æ¥å¤±è´¥**
   - æ£€æŸ¥ApolloæœåŠ¡å™¨åœ°å€
   - ç¡®è®¤ç½‘ç»œè¿æ¥æ­£å¸¸
   - éªŒè¯é˜²ç«å¢™è®¾ç½®

2. **é…ç½®è·å–å¤±è´¥**
   - æ£€æŸ¥AppIdæ˜¯å¦æ­£ç¡®
   - ç¡®è®¤å‘½åç©ºé—´å­˜åœ¨
   - éªŒè¯é…ç½®é¡¹å·²åˆ›å»º

3. **ç›‘å¬å™¨ä¸å·¥ä½œ**
   - ç¡®è®¤é•¿è½®è¯¢å·²å¯åŠ¨
   - æ£€æŸ¥ç›‘å¬å™¨æ³¨å†Œæ­£ç¡®
   - éªŒè¯ApolloæœåŠ¡å™¨æ”¯æŒé•¿è½®è¯¢

### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**
```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

2. **æ£€æŸ¥ç¼“å­˜æ–‡ä»¶**
```bash
ls -la apollo_cache/
cat apollo_cache/demo-app_application.json
```

3. **æµ‹è¯•ç½‘ç»œè¿æ¥**
```bash
curl http://your-apollo-server:8080/configs/demo-app/default/application
```

## ğŸ¯ ApolloæœåŠ¡å™¨è®¾ç½®

### ä½¿ç”¨Dockerå¯åŠ¨Apollo

```bash
# å…‹éš†Apolloé¡¹ç›®
git clone https://github.com/apolloconfig/apollo.git
cd apollo

# å¯åŠ¨Apollo
docker-compose up -d
```

### è®¿é—®Apolloæ§åˆ¶å°

- åœ°å€ï¼šhttp://localhost:8070
- ç”¨æˆ·åï¼šapollo
- å¯†ç ï¼šadmin

### åˆ›å»ºæµ‹è¯•é…ç½®

1. ç™»å½•Apolloæ§åˆ¶å°
2. åˆ›å»ºåº”ç”¨ï¼ˆAppId: demo-appï¼‰
3. åœ¨applicationå‘½åç©ºé—´æ·»åŠ é…ç½®ï¼š
   - `database.url`: `localhost:3306`
   - `redis.host`: `localhost`
   - `app.name`: `demo-app`

## ğŸ“– æ‰©å±•å¼€å‘

### 1. æ·»åŠ é…ç½®éªŒè¯
```python
def validate_config(key, value):
    if key == 'database.url' and not value.startswith('jdbc:'):
        raise ValueError(f"Invalid database URL: {value}")
    return value
```

### 2. æ”¯æŒJSONé…ç½®
```python
import json

def get_json_config(client, key, default='{}'):
    value = client.get_config(key, default)
    return json.loads(value)
```

### 3. é›†æˆåˆ°Flaskåº”ç”¨
```python
from flask import Flask
from apollo_client import ApolloClient
from config import ApolloConfig

app = Flask(__name__)

# åˆå§‹åŒ–Apolloå®¢æˆ·ç«¯
config = ApolloConfig()
apollo_client = ApolloClient(config)

@app.route('/config/<key>')
def get_config(key):
    return {'value': apollo_client.get_config(key, '')}
```

## ğŸ‰ æ€»ç»“

è¿™ä¸ªApolloé…ç½®ä¸­å¿ƒPythonå®¢æˆ·ç«¯Demoæä¾›äº†ï¼š

- âœ… å®Œæ•´çš„Apolloå®¢æˆ·ç«¯å®ç°
- âœ… é…ç½®è·å–å’Œç¼“å­˜åŠŸèƒ½
- âœ… é…ç½®å˜æ›´ç›‘å¬æœºåˆ¶
- âœ… ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ”¯æŒ
- âœ… è¯¦ç»†çš„æ–‡æ¡£å’Œç¤ºä¾‹
- âœ… å®Œæ•´çš„æµ‹è¯•è¦†ç›–
- âœ… æ˜“äºä½¿ç”¨çš„å¯åŠ¨è„šæœ¬

é€šè¿‡è¿™ä¸ªDemoï¼Œæ‚¨å¯ä»¥å¿«é€Ÿäº†è§£å¦‚ä½•åœ¨Pythoné¡¹ç›®ä¸­é›†æˆApolloé…ç½®ä¸­å¿ƒï¼Œå®ç°é…ç½®çš„ç»Ÿä¸€ç®¡ç†å’ŒåŠ¨æ€æ›´æ–°ã€‚

---

**æ³¨æ„ï¼š** è¿™æ˜¯ä¸€ä¸ªæ¼”ç¤ºé¡¹ç›®ï¼Œç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ—¶è¯·æ ¹æ®å®é™…éœ€æ±‚è¿›è¡Œè°ƒæ•´å’Œä¼˜åŒ–ã€‚